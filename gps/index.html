
<!DOCTYPE html>
<html lang="ca">
<head>
<meta charset="UTF-8">
<title>Mesurador de distàncies</title>
<style>
  body { font-family: Arial, sans-serif; margin: 20px; }
  table { border-collapse: collapse; margin-top: 10px; }
  th, td { border: 1px solid #ccc; padding: 5px 10px; text-align: center; }
  input { margin-left: 5px; }
  button { margin-top: 10px; }
</style>
</head>
<body>

<h2>Mesurador de Latitud i Longitud</h2>

<button onclick="mesura()">Mesura</button>
  <!--Aquest botó html executa una funció JavaScript al clicar-se que es troba a la línia  36 que ens permet
  trobar la nostre latitud i longitud. onclick és un atribut del html button que permet unir el 
  botó javascript en la functio mesura quen fem clickal botó.-->
<table id="mesuresTable">
  <!--La línia 23 és linici d'una taula, perquè li hem posat una id, perquè? Podria ser per molts motius, primer, 
  amb un #mesuresTable{propietat1:valor1} podría modificar per exemple els marges de la taula.
  Primerr hauríem d'agafar la id amb un #mesuresTable{color:blue;margin-left:20px}. A més a més de poder canviar
  l'estil de la taula amb un id únic, podem veure que a la línia 63, gràcies a getElementById,
  agafo l'dentificador(mesuresTable) abans que no feia res, i el transformo en una variable de tiupus
  javascript constant perquè així aconseguim poder modificar-la i afegir una altra variable diferent(row).
  -->
  <tr>
    <th>#</th>
    <th>Latitud</th>
    <th>Longitud</th>
    <th>Ubicació</th>
  </tr>
</table>

<h3>Distàncies pas a pas</h3>
<div id="distancies"></div>
  <!--A la línia 40, tinc un divisor que és una àrea identificada amb una id però no visible per defecte
  per l'usuari, la puc fer visible amb codi javascript o css o una combinació que canvi la propietat
  visible a hidden o a la inversa-->

<script>
let mesures = [];
/*La línia 46 és una array. Els [] sempre indiquen arrays o conjunts de dades. Ara l'array és buit
  però és important definir-ho buit per a que es reservi un espai a la memoria del ordinador per emmagatzemar
  diverses dades*/
function mesura() {
  /*La funció mesura el primer que fa és una estructura condicional amb un if que té un signe
  de admiració !(significa negació). 
  if (!navigator.geolocation). El primer if és el condicional que coprova que l'objecte navigator
  de la classe navigator que té un métode anomenat geolocalització està disponible en aquell navegador o no
  El punt que hi ha entre navigator i geolocation és molt important perquè és la síntaxi del punt,
  o dot syntax, és a drir, el punt separa l'objecte del métode que volem aplicar en aquest.
  El punt aplica l'acció. Si el navegador no por executar geolocation haurà de sortir un 
  misatge de alerta.
  El return el que fa és mostrar el missatge en pantalla.
  Alert és una funció de javascript que mostra una finestra emergentt amb un missatge per l'usuari
  i és una funcio molt senzilla perquè només té un argument.Els argument és el que tenim
  a dins dels paréntesi, si no tenim el paréntesis buits. L'únic argument és el text que volem
  mostrar l'usuari. La finestra emergent obliga a l'usuari a tancar-la. S'utilitza per a missatges
  simples com avisos,errors,confirmacions. Hi ha altres tipus de finestres emergent més moderns
  i potents que s'anoenen modals o finestres emergents modals. Si hi ha geolocalització no surt
  la finestra i s'executa la línia 73 i seguents.
  Navegation.geolocation és una API, que significa interface de programació d'aplicacions que 
  ens dona la posició la latitud i longitud de l'usuari. Aquesta aplicació té una funció principal
  que és getCurrentPosition. Té 3 argumetns encara que veiem només 1. El primer argument, es diu
  success/éxit, el segon és error, el tercer és options. Llavors la funció és
  getCurrentPosition(success,error,posotion)El primer argument success és una
  callback, és un sistema que es crida i que permet obtenir laposició, i ho fem amb
  la funció feltcha que és una forma molt ràpida d'escriure una funció sense escriure la paraula funcrion. Les funcions => tenen una sintàxi simplificada i 
  no utilitza la paraula this per referir-se a elles mateixes i ocupen menys espai.
  */
  if (!navigator.geolocation) {
    alert("La geolocalització no és compatible amb aquest navegador.");
    return;
  }

  navigator.geolocation.getCurrentPosition((pos) => {
    const lat = pos.coords.latitude;
    const lon = pos.coords.longitude;

    const ubicacio = prompt("Indica el lloc on s'ha fet la mesura:");

    mesures.push({lat, lon, ubicacio});
    actualitzaTaula();
    calculaDistancies();
  }, (err) => {
    alert("Error al obtenir la localització: " + err.message);
  });
}

function actualitzaTaula() {
  const table = document.getElementById("mesuresTable");
  // netegem totes les files excepte la capçalera
  table.innerHTML = `
    <tr>
      <th>#</th>
      <th>Latitud</th>
      <th>Longitud</th>
      <th>Ubicació</th>
    </tr>`;
  mesures.forEach((m, i) => {
    const row = table.insertRow();
    row.insertCell(0).textContent = i+1;
    row.insertCell(1).textContent = m.lat.toFixed(6);
    row.insertCell(2).textContent = m.lon.toFixed(6);
    row.insertCell(3).textContent = m.ubicacio;
  });
}

function calculaDistancies() {
  const div = document.getElementById("distancies");
  if (mesures.length < 2) {
    div.innerHTML = "Afegiu almenys dues mesures per calcular distàncies.";
    return;
  }

  let html = "";
  for (let i = 0; i < mesures.length - 1; i++) {
    const p1 = mesures[i];
    const p2 = mesures[i+1];

    // Pitàgores (aproximació)
    const dx = (p2.lon - p1.lon) * Math.cos((p1.lat + p2.lat)/2 * Math.PI/180) * 111.32; // km
    const dy = (p2.lat - p1.lat) * 110.574; // km
    const distPitag = Math.sqrt(dx*dx + dy*dy);

    // Haversine
    const R = 6371; // radi de la Terra en km
    const dLat = (p2.lat - p1.lat) * Math.PI/180;
    const dLon = (p2.lon - p1.lon) * Math.PI/180;
    const a = Math.sin(dLat/2)**2 + Math.cos(p1.lat*Math.PI/180)*Math.cos(p2.lat*Math.PI/180)*Math.sin(dLon/2)**2;
    const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
    const distHav = R * c;

    html += `
      <p><b>${i+1} → ${i+2}:</b> ${p1.ubicacio} → ${p2.ubicacio} <br>
      Pitàgores: ${distPitag.toFixed(3)} km, Haversine: ${distHav.toFixed(3)} km</p>`;
  }

  div.innerHTML = html;
}
</script>

</body>
</html>
