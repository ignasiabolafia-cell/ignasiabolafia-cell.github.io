<!--Aquest codi és un HTML i es diu index, html perquè tots els navegadors busquen inex.html per obrir-lo-->
<!DOCTYPE html>

<html lang="ca">
<!--La llengua emprada es català, si fos castellà seria "es" i angles "en"-->
<head>
<!--Head significa capçelera. Tots els codis de html tenen dos parts: head i body. En el head posem contingut que no veu l'usuari o es seundari per l'usuari-->
  <meta charset="UTF-8">
<!--Tot html ha de dir quin conjunt de caràcters o lletres que utilitzem. Això es una metainformació i per això posa meta,
  utf-8 és el conjunt de caràcters que utilitzem, unicode text forma de 8 bits. Utf-8 inclou ç, accents oberts i tancats,
Charset vol dir character set, és el "set" que vol dir conjunt de "characters" o caràcters o lletres.-->
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
<!--El viewport és una metainformació dde com veiem la pàgina web i la veiem amb lo que diu dins de content o contigut.
  Width=device-width significa que la amplada del nostre contingut serà igual a la amplada del dispositiu (device), acepta totes:
  rellotge, mòbil, tauleta, pc, televisió, pantalla de cinema...Initial-scale és la escala inicial és 1.0, si fos 2.0 sortiria el doble de gran
  -->
  <title>Càlcul de la posició d'un robot</title>
<!--Title és el títol de la pestanya i no és el títol del document-->
  <script type="text/javascript" async

    src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.0/es5/tex-mml-chtml.js">
<!--Script és una etiqueta molt importatnt perquè ens indica hi ha després és javascript. La línia anterior carrega matnjax que ens permet que 
  surtin formules matemàtique boniques.-->
  </script>

  <style>
    /* Aquest part del codi és CSS, que serveix per donar estil als elements html
    El codi CSS sempre té la següent estructura. COmença amb una etiqueta html que volem modificar i donar estil,
    a continuació es posa una clau "curly bracket" que engloba una o diverses línies amb la següent estructura:
    propietat1:valor1; propietat2:valor2; etc. I s'acaba amb una clau tancada.
    Per exemple la línia 34 modificarà el body que es troba més a més a baix a la línia 76. Quines són les propietats?
    Font-family és la família del tipus de lletres o font. Hi ha tres famílies de lletres: sans-serif que signifca sense
    serifa. Les serifes són adornaments o remats de les lletres. Les que tenen serifa s'anomenen serif. El tercer tipus és 
    monospace que significa que totes les lletres tenen el mateix ample i això és útil perquè el codi ho necessita.*/ 

    body {

      font-family: Arial, sans-serif;
      /*La línia anterior busca lletra arial per tot el que surti dins del body(línia76) i si no la troba utlilitza una lletra sense serif*/

      margin: 20px;
      /*Margin és el marge exterior. CSS té un model de caixa o box model en el que el contingut o content està envoltat pel pdding i 
      aquest està envoltat pel border i el border està envoltat pel margin. Margin, padding i border són propietats CSS que puc aplicar a diferents
      etiquetes o tags html. Despreés de la propietat hi ha un valor en píxels, a vegades hi ha dos valors en píxels i a vegades tres valors.
      Si hi ha un valor s'aplica en totes direccions si hi ha dos valors s'apliquen el primer a dalt i a baix i el segon valor a la dreta i a la esquerra.
      Si ha tres valors, s'apñica el primer valor adalt, el segon valor a la dreta i a la esquerra. Si hi ha dos valors s'aplica el primer adalt i abaix i el segon
      a la dreta i a la esquerra. Si hi ha tres valors s'aplica: el primer valor s'aplica adalt, el segon a la dreta i a l'esquerra
      i el tercer abaix.Si hi ha quatre números, el primer número és el marge superior, el segon és la dreta, el tercer abaix, i el
      quart l'esquerra. Tot el body amb tot el cintingut html visible per l'usuari amb paràgrafs, dibuixos(canvas), tindrà un marge de 20px
      per tots els cotats i no queden les lletres o els dibuixos enganxats als extrems de l'ordinador o del mobil.*/
    }


    .equation {
     /*Equation amb un punt davant signific aque és una clase o class que pot repetir-se 
      diverses vegades en el codi. Si jo faig una classe la pur repetir, si faig un identificador sería una # i no es pot repetir
      Per exemple #output només hi ha un output.També només pot haver 1 canvas(àrea de dibuix).tot el que tingui la classe equation
      tindrà un marge de 20 pixels al voltant per exemple a la línia 141, sortirà un marge.*/

      margin: 20px 0;

    }


    .results {

      font-weight: bold;

    }


    /* Oculta els elements de sortida per defecte */

    #output, #robotCanvas {

      display: none;

    }


    canvas {

      border: 1px solid black;

    }

  </style>

</head>

<body>

  <h1>Càlcul de la posició d'un robot amb dos braços</h1>

  <div>

    <label for="a1">Longitud del primer braç (a₁):</label>
    /*label es tradueix com "etiqueta". És un espai que seveix coma a indicador del que s'ha de posar a l'input.*/

    <input type="number" id="a1" value="1" step="0.1"><br><br>
    /*Input significa una entrada de informació per part de l'usuari.
    Apareix una caixa de text per esciure que només accepta números, perquè type="number"
    id significa identificador únic, és com un DNI. 
    Value és el valor per defecte, si no hi ha cap valor per defecte especificat, surt aquest a la caixa de text.
    step significa la variació que es pot produir.
    br és una línia en blanc, un espai.*/


    <label for="a2">Longitud del segon braç (a₂):</label>

    <input type="number" id="a2" value="0.5" step="0.1"><br><br>


    <label for="q1">Angle del primer braç (q₁, en graus):</label>

    <input type="number" id="q1" value="45" step="0.1"><br><br>


    <label for="q2">Angle del segon braç (q₂, en graus):</label>

    <input type="number" id="q2" value="30" step="0.1"><br><br>


    <button onclick="calculatePosition()">Calcula la posició</button>
    /*La línia 125 relaciona el codi html amb el codi javascript perquè la
    etiqueta "button" de html té una propietat anomenada "oncklick" que
    executa una funció javascript*/

  </div>

  <div id="output"></div>

  <canvas id="robotCanvas" width="400" height="400"></canvas>


<script>

function calculatePosition() {

  // Agafar les dades introduïdes per l'usuari

  let a1 = parseFloat(document.getElementById('a1').value);

  let a2 = parseFloat(document.getElementById('a2').value);

  let q1_deg = parseFloat(document.getElementById('q1').value); // Grados

  let q2_deg = parseFloat(document.getElementById('q2').value); // Grados

  let q1 = q1_deg * Math.PI / 180; // Convertir graus a radians

  let q2 = q2_deg * Math.PI / 180; // Convertir graus a radians


  // **Mostrar els contenidors de sortida**

  document.getElementById('output').style.display = 'block';

  document.getElementById('robotCanvas').style.display = 'block';


  // Fase 1: Fórmules

  let output = "<div class='equation'>Les equacions per calcular la posició final del robot són:</div>";

  output += "<div class='equation'>\\[ x = a_1 \\cos(q_1) + a_2 \\cos(q_1 + q_2) \\]</div>";

  output += "<div class='equation'>\\[ y = a_1 \\sin(q_1) + a_2 \\sin(q_1 + q_2) \\]</div>";


  // Fase 2: Substituir les variables

  output += "<div class='equation'>Substituïm els valors:</div>";

  output += `<div class='equation'>\\[ x = ${a1} \\cos(${q1_deg}°) + ${a2} \\cos(${q1_deg}° + ${q2_deg}°) \\]</div>`;

  output += `<div class='equation'>\\[ y = ${a1} \\sin(${q1_deg}°) + ${a2} \\sin(${q1_deg}° + ${q2_deg}°) \\]</div>`;


  // Fase 3: Càlcul numèric detallat

  let x1 = a1 * Math.cos(q1);

  let x2 = a2 * Math.cos(q1 + q2);

  let y1 = a1 * Math.sin(q1);

  let y2 = a2 * Math.sin(q1 + q2);


  output += "<div class='equation'>Desglossant els càlculs:</div>";

  output += `<div class='equation'>\\[ x_1 = a_1 \\cos(q_1) = ${a1} \\times \\cos(${q1_deg}°) = ${x1.toFixed(2)} \\]</div>`;

  output += `<div class='equation'>\\[ x_2 = a_2 \\cos(q_1 + q_2) = ${a2} \\times \\cos(${q1_deg}° + ${q2_deg}°) = ${x2.toFixed(2)} \\]</div>`;

  output += `<div class='equation'>\\[ y_1 = a_1 \\sin(q_1) = ${a1} \\times \\sin(${q1_deg}°) = ${y1.toFixed(2)} \\]</div>`;

  output += `<div class='equation'>\\[ y_2 = a_2 \\sin(q_1 + q_2) = ${a2} \\times \\sin(${q1_deg}° + ${q2_deg}°) = ${y2.toFixed(2)} \\]</div>`;


  // Resultat final

  let x = x1 + x2;

  let y = y1 + y2;


  output += "<div class='equation'>Calculant els resultats numèrics totals:</div>";

  output += `<div class='equation'>\\[ x = ${x.toFixed(2)} \\]</div>`;

  output += `<div class='equation'>\\[ y = ${y.toFixed(2)} \\]</div>`;


  // Mostrar el resultat

  document.getElementById('output').innerHTML = output;

  MathJax.typeset(); // Renderitzar MathJax per mostrar les fórmules correctament


  // Fase 4: Part gràfica

  let canvas = document.getElementById('robotCanvas');

  let ctx = canvas.getContext('2d');


  ctx.clearRect(0, 0, canvas.width, canvas.height); // Netejar canvas


  // Centre i escales

  let centerX = canvas.width / 2;

  let centerY = canvas.height / 2;

  let scale = 80;


  // Coordenades

  let x1_screen = centerX + x1 * scale;

  let y1_screen = centerY - y1 * scale;

  let x2_screen = centerX + x * scale;

  let y2_screen = centerY - y * scale;


  // Dibuxar braç 1

  ctx.beginPath();

  ctx.moveTo(centerX, centerY);

  ctx.lineTo(x1_screen, y1_screen);

  ctx.strokeStyle = 'blue';

  ctx.lineWidth = 5;

  ctx.stroke();


  // Dibuxar braç 2

  ctx.beginPath();

  ctx.moveTo(x1_screen, y1_screen);

  ctx.lineTo(x2_screen, y2_screen);

  ctx.strokeStyle = 'green';

  ctx.lineWidth = 5;

  ctx.stroke();


  // Dibuxar els cercles als extrems

  ctx.beginPath();

  ctx.arc(centerX, centerY, 5, 0, 2 * Math.PI); // Base del braç

  ctx.fillStyle = 'red';

  ctx.fill();


  ctx.beginPath();

  ctx.arc(x1_screen, y1_screen, 5, 0, 2 * Math.PI); // Final del primer braç

  ctx.fillStyle = 'red';

  ctx.fill();


  ctx.beginPath();

  ctx.arc(x2_screen, y2_screen, 5, 0, 2 * Math.PI); // Final del segon braç

  ctx.fillStyle = 'red';

  ctx.fill();

}

</script>

</body>

</html>

